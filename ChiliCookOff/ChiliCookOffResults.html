<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Holiday Chili Showdown - Results</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
  --sweater-green: #0f4d2c;
  --red-header: #8c1c13;       /* deep chili red */
  --red-highlight: #b32116;    /* brighter winner red */
  --table-border: #dddddd;
  --text-dark: #222;
  --text-light: #fff;
}

/* Sweater-style green background */
body {
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  margin: 0;
  padding: 20px;
  background-color: var(--sweater-green);
  background-image:
    linear-gradient(135deg, rgba(255,255,255,0.06) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.06) 50%, rgba(255,255,255,0.06) 75%, transparent 75%, transparent),
    linear-gradient(225deg, rgba(255,255,255,0.06) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.06) 50%, rgba(255,255,255,0.06) 75%, transparent 75%, transparent);
  background-size: 14px 14px;
  background-position: 0 0, 7px 7px;
  color: var(--text-light);
}

.container {
  max-width: 1000px;
  margin: 0 auto;
  text-align: center;
}

/* Header title */
h1 {
  margin: 0;
  margin-bottom: 6px;
  color: #fffbe8;
  font-size: 2rem;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  padding: 10px 12px;
  border-radius: 14px;
  background: rgba(0,0,0,0.25);
  box-shadow: 0 4px 12px rgba(0,0,0,0.35);
}

.subtitle {
  font-size: 1rem;
  color: #e7fce5;
  margin-bottom: 6px;
}

.status {
  font-size: 0.9rem;
  color: #e8ffe0;
  margin-bottom: 16px;
}

/* Table card */
.table-wrapper {
  background: rgba(255,255,255,1);
  border-radius: 16px;
  padding: 16px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  overflow-x: auto;
  margin-bottom: 20px;
}

/* TABLE */
table {
  width: 100%;
  border-collapse: collapse;
  min-width: 650px;
}

/* Red header bar */
thead {
  background: var(--red-header);
  color: var(--text-light);
}

th {
  padding: 12px;
  text-align: left;
  font-size: 1rem;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.03em;
}

/* Body rows */
td {
  padding: 12px;
  font-size: 0.95rem;
  color: var(--text-dark);
  border-bottom: 1px solid var(--table-border);
}

/* Light alternating rows */
tr:nth-child(even) td {
  background: #fafafa;
}
tr:nth-child(odd) td {
  background: #ffffff;
}

/* Winner highlight row */
tr.highlight td {
  background: var(--red-highlight) !important;
  color: #fff !important;
  font-weight: 600;
  box-shadow: inset 0 0 0 3px #ffffff33;
}

/* Column tweaks */
.rank {
  font-weight: 700;
}

.points {
  font-weight: 700;
}

.avg-stars {
  font-weight: 600;
}

/* Responsive improvements */
@media (min-width: 900px) {
  h1 {
    font-size: 2.3rem;
  }
  th, td {
    font-size: 1rem;
  }
}
  </style>
</head>
<body>
  <div class="container">
    <h1>THE 6TH ANNUAL UGLY SWEATER CHILI COOKOFF üå∂Ô∏è</h1>
    <div class="subtitle">Final Rankings</div>
    <div id="status" class="status">Loading results‚Ä¶</div>

    <div class="table-wrapper">
      <table id="resultsTable">
        <thead>
          <tr>
            <th>Rank</th>
            <th>Chili</th>
            <th>Points</th>
            <th>1st</th>
            <th>2nd</th>
            <th>3rd</th>
            <th>Avg Stars</th>
            <th>Ratings</th>
          </tr>
        </thead>
        <tbody>
          <!-- rows injected -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbx_1di_mud4nXbfxoLYlKWxwmKQKEuo6_J_62oGVUcxbcEJf9yI5jvdj7ML5jywMjp_fA/exec'; // same as voting page
    const EVENT_ID = 'holiday_2025';

    const statusEl = document.getElementById('status');
    const tbody = document.querySelector('#resultsTable tbody');

    function formatStars(avg) {
      if (avg == null) return '‚Äî';
      const rounded = Math.round(avg * 10) / 10;
      return rounded.toFixed(1);
    }

    async function loadResults() {
      try {
        const url = `${WEB_APP_URL}?mode=results&event_id=${encodeURIComponent(EVENT_ID)}`;
        const res = await fetch(url);
        const data = await res.json();

        const results = data.results || [];

        if (!results.length) {
          statusEl.textContent = 'No votes received yet.';
          return;
        }

        statusEl.textContent = `Total chilis: ${results.length}`;

        tbody.innerHTML = '';
        results.forEach(r => {
          const tr = document.createElement('tr');
          if (r.rank === 1) {
            tr.classList.add('highlight');
          }

          const avg = formatStars(r.avgStars);

          tr.innerHTML = `
            <td class="rank">#${r.rank}</td>
            <td>#${r.chiliId} ‚Äì ${r.name}</td>
            <td class="points">${r.points}</td>
            <td>${r.firsts}</td>
            <td>${r.seconds}</td>
            <td>${r.thirds}</td>
            <td class="stars">
              <span class="avg-stars">${avg !== '‚Äî' ? avg : '‚Äî'}</span>
            </td>
            <td>${r.starCount}</td>
          `;
          tbody.appendChild(tr);
        });

      } catch (err) {
        console.error(err);
        statusEl.textContent = 'Error loading results. Check the script or network.';
      }
    }

    loadResults();
  </script>
</body>
</html>