<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Holiday Chili Showdown - Vote</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --sweater-red: #b31224;
      --card-bg: #fffaf4;
      --card-white: #ffffff;
      --accent-green: #276749;
      --accent-gold: #b8860b;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 16px;
      color: #222;
      /* sweater-style red background */
      background-color: var(--sweater-red);
      background-image:
        linear-gradient(135deg, rgba(255,255,255,0.09) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.09) 50%, rgba(255,255,255,0.09) 75%, transparent 75%, transparent),
        linear-gradient(225deg, rgba(255,255,255,0.09) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.09) 50%, rgba(255,255,255,0.09) 75%, transparent 75%, transparent);
      background-size: 16px 16px;
      background-position: 0 0, 8px 8px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

  /* ==== HEADER HERO SECTION ==== */

.header-hero {
  text-align: center;
  padding: 20px 16px;
  background: rgba(0,0,0,0.28);
  border-radius: 16px;
  color: #fff7e6;
  margin-bottom: 16px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.35);
  backdrop-filter: blur(5px);
}

.hero-title {
  margin: 0;
  font-size: 1.6rem;
  letter-spacing: 0.03em;
  text-transform: uppercase;
  line-height: 1.2;
}

.hero-subtitle {
  font-size: 0.95rem;
  color: #ffe6c2;
  margin-top: 6px;
}

.hero-info {
  margin-top: 14px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
}

.date-time {
  font-size: 0.85rem;
  color: #ffe6c2;
}

.tag {
  padding: 4px 12px;
  border-radius: 999px;
  border: 1px solid #ffd27f;
  background: rgba(0,0,0,0.3);
  font-size: 0.78rem;
  display: inline-block;
  white-space: nowrap;
}

@media (min-width: 600px) {
  .hero-title {
    font-size: 2rem;
  }
  .hero-info {
    flex-direction: row;
    justify-content: center;
    gap: 12px;
  }
}

    @media (max-width: 480px) {
      .header-card {
        flex-direction: column;
        align-items: flex-start;
      }
      .header-badge {
        text-align: left;
      }
    }

    h1 {
      text-align: center;
      margin-bottom: 4px;
      color: #fff7e6;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      font-size: 1.4rem;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,0.25);
      box-shadow: 0 2px 6px rgba(0,0,0,0.35);
    }

    .subtitle {
      text-align: center;
      font-size: 0.95rem;
      color: #ffe6c2;
      margin-bottom: 16px;
    }

    .instructions {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 12px 16px;
      margin-bottom: 16px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.25);
      font-size: 0.9rem;
      border: 1px solid rgba(0,0,0,0.06);
      position: relative;
      overflow: hidden;
    }

    .instructions::before {
      content: "‚ùÑÔ∏è";
      position: absolute;
      right: 10px;
      top: 6px;
      opacity: 0.3;
      font-size: 1.2rem;
    }

    .instructions strong {
      color: var(--accent-green);
    }

    .instructions ol {
      padding-left: 20px;
      margin: 8px 0;
    }

    .badge {
      display: inline-block;
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: #fff7e0;
      color: #7c2d12;
      margin-left: 4px;
      border: 1px solid rgba(251, 191, 36, 0.7);
    }

    .chili-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 12px;
      margin-bottom: 20px;
    }

    .chili-card {
      background: var(--card-white);
      border-radius: 12px;
      padding: 10px 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.18);
      border: 1px solid rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      min-height: 120px;
      position: relative;
      overflow: hidden;
    }

    .chili-card::before {
      content: "üéÑ";
      position: absolute;
      right: 8px;
      top: 6px;
      font-size: 0.9rem;
      opacity: 0.22;
    }

    .chili-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 6px;
    }

    .chili-number {
      font-weight: 700;
      font-size: 1rem;
      color: var(--accent-green);
    }

    .chili-name {
      font-size: 0.9rem;
      color: #444;
    }

    .chili-meta {
      font-size: 0.75rem;
      color: #777;
      margin-bottom: 6px;
    }

    .stars {
      display: inline-flex;
      gap: 2px;
      font-size: 1.1rem;
      cursor: pointer;
      user-select: none;
    }

    .star {
      padding: 0 2px;
      transition: transform 0.08s ease;
    }

    .star.filled {
      color: #d69e2e;
    }

    .star.empty {
      color: #ccc;
    }

    .star:active {
      transform: scale(1.15);
    }

    .top3-panel {
      background: #fffdf6;
      border-radius: 12px;
      padding: 14px 16px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.25);
      border: 1px solid rgba(240, 224, 176, 0.9);
      margin-bottom: 12px;
    }

    .top3-panel h2 {
      margin: 0 0 6px;
      font-size: 1.05rem;
      color: #7c2d12;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .top3-panel h2::before {
      content: "üèÜ";
    }

    .top3-row {
      display: grid;
      grid-template-columns: 90px 1fr;
      gap: 8px;
      align-items: center;
      margin-bottom: 8px;
    }

    .place-label {
      font-size: 0.9rem;
      font-weight: 600;
    }
    .place-label.first { color: var(--accent-gold); }
    .place-label.second { color: #708090; }
    .place-label.third { color: #8b4513; }

    select {
      width: 100%;
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 0.9rem;
      background: #fff;
    }

    .small-text {
      font-size: 0.8rem;
      color: #666;
      margin-top: 4px;
    }

    .status-bar {
      font-size: 0.8rem;
      color: #f9fafb;
      margin-bottom: 10px;
      text-align: center;
    }

    .success, .error {
      font-size: 0.9rem;
      text-align: center;
      border-radius: 12px;
      padding: 10px 14px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.35);
      pointer-events: auto; /* allow copying text if needed */
    }

    .success {
      background: #22543d;
      color: #e6fffa;
      border: 1px solid #38a169;
    }

    .error {
      background: #742a2a;
      color: #fed7d7;
      border: 1px solid #f56565;
    }

    .submit-btn {
      width: 100%;
      padding: 10px;
      border-radius: 999px;
      border: none;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      background: linear-gradient(135deg, #16a34a, #15803d);
      color: #fff;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }

    .submit-btn:active {
      transform: translateY(1px);
      box-shadow: 0 2px 4px rgba(0,0,0,0.25);
    }

    .reset-btn {
      margin-top: 8px;
      width: 100%;
      padding: 6px;
      border-radius: 999px;
      border: 1px dashed rgba(255,255,255,0.6);
      font-size: 0.75rem;
      background: transparent;
      color: #fefcbf;
      cursor: pointer;
      opacity: 0.7;
      position: relative;
      z-index: 10; /* make sure it's above main content but below toast *
    }

    .reset-btn:hover {
      opacity: 1;
    }

        /* Toast container ‚Äì fixed near bottom center */
        #message {
  position: fixed;
  bottom: 12px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 999999; /* stays on top */
  width: min(420px, 90vw);
  pointer-events: none;
}

    @media (max-width: 480px) {
      body {
        padding: 10px;
      }
      .top3-row {
        grid-template-columns: 1fr;
      }
    }
    body {
  padding-bottom: 80px; /* keeps bottom UI elements visible above toast */
}
  </style>
</head>
<body>

    <div class="container">
        <div class="header-card">
            <div class="header-hero">
                <h1 class="hero-title">THE 6TH ANNUAL UGLY SWEATER CHILI COOKOFF üå∂Ô∏è</h1>
                <div class="hero-subtitle">Rate as you taste, then choose your Top 3 favorites</div>
              
                <div class="hero-info">
                 
                  <div class="tag">It‚Äôs gonna get ugly &amp; tasty</div>
                </div>
              </div>
    
        <div class="instructions">
          <strong>How it works:</strong>
          <ol>
            <li>As you taste each chili, tap the stars to rate it (1‚Äì5). This is just to help you remember what you liked.</li>
            <li>When you‚Äôre ready, pick your <strong>1st, 2nd, and 3rd place</strong> from the chilis you rated.</li>
            <li>Only chilis with at least 1 star will show up in the Top 3 dropdowns.</li>
          </ol>
        </div>

        <div id="status" class="status-bar"></div>

        <div class="chili-grid" id="chiliGrid"></div>
        
        <div class="top3-panel">

      <h2>Your Top 3</h2>
      <div class="small-text">
        Stars are just for you. Only your 1st, 2nd, and 3rd choices count for the contest.
      </div>

      <div class="top3-row">
        <div class="place-label first">ü•á 1st place</div>
        <div><select id="firstSelect"><option value="">Select chili</option></select></div>
      </div>
      <div class="top3-row">
        <div class="place-label second">ü•à 2nd place</div>
        <div><select id="secondSelect"><option value="">Select chili</option></select></div>
      </div>
      <div class="top3-row">
        <div class="place-label third">ü•â 3rd place</div>
        <div><select id="thirdSelect"><option value="">Select chili</option></select></div>
      </div>

      <div class="small-text">
        You can‚Äôt pick the same chili more than once.
      </div>
    </div>

    <div id="message"></div>


    <button class="submit-btn" id="submitBtn">Submit my vote</button>
   

    <button class="reset-btn" id="resetDeviceBtn" type="button">
      Host:
    </button>
  </div>

  <script>
    // REPLACE THIS with your Web App /exec URL
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbx_1di_mud4nXbfxoLYlKWxwmKQKEuo6_J_62oGVUcxbcEJf9yI5jvdj7ML5jywMjp_fA/exec';

    const chilis = [
      { id: 1, name: "Rudolph's Revenge" },
      { id: 2, name: "Grandma's Secret Weapon" },
      { id: 3, name: "North Pole Night Fire" },
      { id: 4, name: "Frostbite Firestorm" },
      { id: 5, name: "Santa's Smoke Bomb" },
      { id: 6, name: "Elves Only Chili" },
      { id: 7, name: "Blizzard Burner" },
      { id: 8, name: "Mistletoe Madness" },
      { id: 9, name: "Snow Day Surprise" },
      { id: 10, name: "Holiday Heatwave" }
    ];

    const chiliGrid = document.getElementById("chiliGrid");
    const statusBar = document.getElementById("status");
    const msgBox = document.getElementById("message");

    const firstSelect = document.getElementById("firstSelect");
    const secondSelect = document.getElementById("secondSelect");
    const thirdSelect = document.getElementById("thirdSelect");

    const submitBtn = document.getElementById("submitBtn");
    const resetDeviceBtn = document.getElementById("resetDeviceBtn");

    // ratingMap: chiliId -> 0..5
    const ratingMap = new Map();

    function renderStatus() {
      const ratedCount = Array.from(ratingMap.values()).filter(v => v > 0).length;
      statusBar.textContent = `You have rated ${ratedCount} of ${chilis.length} chilis.`;
    }

    function createStarElement(chiliId, starValue) {
      const span = document.createElement("span");
      span.className = "star empty";
      span.textContent = "‚òÖ";
      span.addEventListener("click", () => {
        setRating(chiliId, starValue);
      });
      return span;
    }

    function setRating(chiliId, value) {
      ratingMap.set(chiliId, value);
      updateStars(chiliId);
      updateDropdownOptions();
      renderStatus();
    }

    function updateStars(chiliId) {
      const rating = ratingMap.get(chiliId) || 0;
      const card = document.querySelector(`.chili-card[data-id="${chiliId}"]`);
      if (!card) return;
      const stars = card.querySelectorAll(".star");
      stars.forEach((starEl, index) => {
        const starValue = index + 1;
        if (starValue <= rating) {
          starEl.classList.add("filled");
          starEl.classList.remove("empty");
        } else {
          starEl.classList.add("empty");
          starEl.classList.remove("filled");
        }
      });
    }

    function renderChiliCards() {
      chiliGrid.innerHTML = "";
      chilis.forEach(chili => {
        ratingMap.set(chili.id, 0);

        const card = document.createElement("div");
        card.className = "chili-card";
        card.dataset.id = chili.id;

        const header = document.createElement("div");
        header.className = "chili-header";

        const num = document.createElement("div");
        num.className = "chili-number";
        num.textContent = `Chili #${chili.id}`;

        const badge = document.createElement("span");
        badge.className = "badge";
        badge.textContent = "üå∂Ô∏è";

        header.appendChild(num);
        header.appendChild(badge);

        const name = document.createElement("div");
        name.className = "chili-name";
        name.textContent = chili.name;

        const meta = document.createElement("div");
        meta.className = "chili-meta";
        meta.textContent = "Tap 1‚Äì5 stars to rate this chili.";

        const starsContainer = document.createElement("div");
        starsContainer.className = "stars";

        for (let i = 1; i <= 5; i++) {
          const starEl = createStarElement(chili.id, i);
          starsContainer.appendChild(starEl);
        }

        card.appendChild(header);
        card.appendChild(name);
        card.appendChild(meta);
        card.appendChild(starsContainer);
        chiliGrid.appendChild(card);
      });
    }

    function getRatedChilis() {
      return chilis.filter(c => (ratingMap.get(c.id) || 0) > 0);
    }

    function resetSelectOptions(selectEl, label) {
      selectEl.innerHTML = "";
      const opt = document.createElement("option");
      opt.value = "";
      opt.textContent = label;
      selectEl.appendChild(opt);
    }

    function updateDropdownOptions() {
      const rated = getRatedChilis();
      const chosenIds = new Set(
        [firstSelect.value, secondSelect.value, thirdSelect.value].filter(Boolean)
      );

      function fillSelect(selectEl, label) {
        const current = selectEl.value;
        resetSelectOptions(selectEl, label);

        rated.forEach(chili => {
          if (!chosenIds.has(chili.id.toString()) || current === chili.id.toString()) {
            const opt = document.createElement("option");
            const rating = ratingMap.get(chili.id) || 0;
            const starsText = "‚òÖ".repeat(rating) + "‚òÜ".repeat(5 - rating);
            opt.value = chili.id;
            opt.textContent = `#${chili.id} ‚Äì ${chili.name} (${starsText})`;
            selectEl.appendChild(opt);
          }
        });

        if (current && [...selectEl.options].some(o => o.value === current)) {
          selectEl.value = current;
        }
      }

      fillSelect(firstSelect, "Select chili");
      fillSelect(secondSelect, "Select chili");
      fillSelect(thirdSelect, "Select chili");
    }

    function showError(text) {
      msgBox.innerHTML = `<div class="error">${text}</div>`;
    }

    function showSuccess(text) {
      msgBox.innerHTML = `<div class="success">${text}</div>`;
    }

    // Hidden-form POST to avoid CORS headaches
    function postVoteViaForm(vote) {
      let iframe = document.getElementById('hidden_iframe_for_post');
      if (!iframe) {
        iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.name = 'hidden_iframe_for_post';
        iframe.id = 'hidden_iframe_for_post';
        document.body.appendChild(iframe);
      }

      const form = document.createElement('form');
      form.method = 'POST';
      form.action = WEB_APP_URL;
      form.target = 'hidden_iframe_for_post';

      const input = document.createElement('input');
      input.type = 'hidden';
      input.name = 'payload';
      input.value = JSON.stringify(vote);
      form.appendChild(input);

      document.body.appendChild(form);
      form.submit();
      document.body.removeChild(form);
    }

    function submitVote() {
      msgBox.innerHTML = "";

      const first = firstSelect.value;
      const second = secondSelect.value;
      const third = thirdSelect.value;

      if (!first || !second || !third) {
        showError("Please select a chili for 1st, 2nd, and 3rd place.");
        return;
      }
      if (first === second || first === third || second === third) {
        showError("Each place must be a different chili.");
        return;
      }

      const ids = [first, second, third].map(v => parseInt(v, 10));
      for (const id of ids) {
        if ((ratingMap.get(id) || 0) === 0) {
          showError("You can only vote for chilis you rated with at least 1 star.");
          return;
        }
      }

      const ratingsObj = {};
      ratingMap.forEach((val, key) => {
        if (val > 0) ratingsObj[key] = val;
      });

      const vote = {
        eventId: 'holiday_2025',
        first: ids[0],
        second: ids[1],
        third: ids[2],
        ratings: ratingsObj,
        submittedAt: new Date().toISOString()
      };

      try {
        postVoteViaForm(vote);
        showSuccess("Thanks! Your vote has been recorded.");

        // mark this device as having voted
        localStorage.setItem("chiliVoteSubmitted", "1");
        submitBtn.disabled = true;
        submitBtn.textContent = "Vote submitted";
      } catch (err) {
        console.error(err);
        showError("Sorry, there was a problem saving your vote. Please tell the host.");
      }
    }

    submitBtn.addEventListener("click", submitVote);

// Host reset: clear device lock
resetDeviceBtn.addEventListener("click", () => {
  const ok = confirm("Host only: clear this device's vote and allow another submission?");
  if (!ok) return;
  localStorage.removeItem("chiliVoteSubmitted");
  // simple reset: reload page
  location.reload();
});

// Initial render
renderChiliCards();
renderStatus();
updateDropdownOptions();

[firstSelect, secondSelect, thirdSelect].forEach(select => {
  select.addEventListener("change", updateDropdownOptions);
});

// Lock out if this device already voted
if (localStorage.getItem("chiliVoteSubmitted") === "1") {
  showSuccess("This device has already submitted a vote. If this is a new voter, ask Marc or Christy to clear this message.'.");
  submitBtn.disabled = true;
  submitBtn.textContent = "Vote already submitted";
}
  </script>
</body>
</html>